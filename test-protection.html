<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MEV Shield Protection Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-box {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .status.success { background: #d4edda; border: 1px solid #c3e6cb; }
        .status.error { background: #f8d7da; border: 1px solid #f5c6cb; }
    </style>
</head>
<body>
    <h1>üõ°Ô∏è MEV Shield Protection Test</h1>
    
    <div class="test-box">
        <h2>Step 1: Test Basic Connectivity (REAL)</h2>
        <p><strong>These are REAL tests to your deployed Worker:</strong></p>
        <button onclick="testConnection()">Test Connection</button>
        <button onclick="testBalance()">Test Balance Check</button>
        <button onclick="testBlockNumber()">Test Block Number</button>
        <div id="connection-results"></div>
    </div>

    <div class="test-box">
        <h2>Step 2: Test Protection Mechanism (Simulation)</h2>
        <p>This simulates how your agent protects transactions from front-running:</p>
        <button onclick="simulateProtection()">Simulate Protection</button>
        <div id="protection-results"></div>
    </div>

    <div class="test-box">
        <h2>Step 3: Real Transaction Test (MetaMask)</h2>
        <p><strong>To test REAL transactions:</strong></p>
        <ol>
            <li>Open MetaMask</li>
            <li>Go to Settings ‚Üí Networks</li>
            <li>Click "Ethereum Mainnet" ‚Üí "Edit"</li>
            <li>Replace RPC URL with: <code>https://mev-shield.mev-shield.workers.dev/rpc</code></li>
            <li>Save and send a small test transaction</li>
        </ol>
        <button onclick="testRealTransaction()">Test Real Transaction (MetaMask)</button>
        <div id="real-transaction-results"></div>
    </div>

    <script>
        const RPC_URL = 'https://mev-shield.mev-shield.workers.dev/rpc';
        
        async function testConnection() {
            try {
                const response = await fetch(RPC_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        jsonrpc: '2.0',
                        id: 1,
                        method: 'eth_chainId',
                        params: []
                    })
                });
                const data = await response.json();
                showResult('connection-results', 'Connection Test (REAL)', data, 'success');
            } catch (error) {
                showResult('connection-results', 'Connection Test (REAL)', error.message, 'error');
            }
        }
        
        async function testBalance() {
            try {
                const response = await fetch(RPC_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        jsonrpc: '2.0',
                        id: 1,
                        method: 'eth_getBalance',
                        params: ['0x742d35Cc6634C0532925a3b8D4C9db96C4b4d8b6', 'latest']
                    })
                });
                const data = await response.json();
                showResult('connection-results', 'Balance Check (REAL)', data, 'success');
            } catch (error) {
                showResult('connection-results', 'Balance Check (REAL)', error.message, 'error');
            }
        }
        
        async function testBlockNumber() {
            try {
                const response = await fetch(RPC_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        jsonrpc: '2.0',
                        id: 1,
                        method: 'eth_blockNumber',
                        params: []
                    })
                });
                const data = await response.json();
                showResult('connection-results', 'Block Number (REAL)', data, 'success');
            } catch (error) {
                showResult('connection-results', 'Block Number (REAL)', error.message, 'error');
            }
        }
        
        function simulateProtection() {
            const protectionSteps = [
                '1. User signs transaction locally',
                '2. Transaction sent to MEV Shield agent',
                '3. Agent routes through private relays:',
                '   - Flashbots Protect',
                '   - bloXroute Protect', 
                '   - Eden RPC',
                '4. Transaction bypasses public mempool',
                '5. No front-running possible!',
                '6. Transaction hash returned to user'
            ];
            
            const result = {
                protection: 'ACTIVE',
                steps: protectionSteps,
                timestamp: new Date().toISOString()
            };
            
            showResult('protection-results', 'Protection Simulation', result, 'success');
        }
        
        function testRealTransaction() {
            const result = {
                message: 'To test REAL transactions:',
                steps: [
                    '1. Open MetaMask',
                    '2. Go to Settings ‚Üí Networks',
                    '3. Edit Ethereum Mainnet',
                    '4. Replace RPC URL with: https://mev-shield.mev-shield.workers.dev/rpc',
                    '5. Save and send a small transaction',
                    '6. Your transaction will be protected from front-running!'
                ],
                note: 'This requires MetaMask to be installed and connected'
            };
            
            showResult('real-transaction-results', 'Real Transaction Test', result, 'success');
        }
        
        function showResult(elementId, testName, data, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = `
                <div class="status ${type}">
                    <h3>${testName} Result:</h3>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                </div>
            `;
        }
    </script>
</body>
</html>
